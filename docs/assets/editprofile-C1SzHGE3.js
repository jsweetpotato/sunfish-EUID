import"./tailwind-GolohDhN.js";import{a as h,g as a}from"./getNode-pa7syr6m.js";import{c as W,a as G,p as b}from"./delay-YOOEtQ5Y.js";import{c as z}from"./checkAuth-1jN6PZSr.js";const K=e=>{const t=h(".valid-input-box");function c(n){const o=+n.dataset.index,{min:s,max:u}=e[o],p=n.value.replace(/\s*/g,"").length,f=p>s&&p<=u;return e[o].isValid=f,f}function g(n,o){const s=n.closest(".input-wrapper");o?s.classList.remove("invalid"):s.classList.add("invalid")}function i(n){const{value:o}=n,s=+n.dataset.index,u=n.nextElementSibling.querySelector(".letter-count");u.textContent=`${o.length}/${e[s].max}`}function H({target:n}){const o=c(n);g(n,o),i(n)}const M={state:!1},j=[];return[t.forEach((n,o)=>{const{id:s,min:u=0,max:p=24,placeholder:f="",label:D}=e[o],F=`
      <label for="${s}" class="text-label-sm pb-2">${D}</label>
      <div class="input-wrapper group flex flex-col w-full">
        <input
          type="text"
          id=${s}
          data-index="${o}"
          placeholder="${f}"
          minlength="${u}"
          maxlength="${p}"
          class="group-[.invalid]:border-red-500 p-2 text-paragraph-sm w-full outline-none border border-contents-content-tertiary rounded"
          spellcheck="false"
        />
        <div class="flex justify-between">
          <span
            class="group-[&:not(.invalid)]:opacity-0 text-red-500 text-paragraph-sm opacity-1"
          >글자 수는 ${u+1}자 이상 ${p}자 이하로 작성해주세요.</span>
          <span
            aria-live="polite"
            class="group-[.invalid]:text-red-500 letter-count text-contents-content-tertiary text-paragraph-sm"
          >0/${p}</span>
        </div>
      </div>
      `;n.insertAdjacentHTML("beforeend",F);const B=a(`input#${s}`);B.addEventListener("input",H),j.push(B),Object.defineProperty(M,"state",{get(){return this._state},set(J){this._state=J,j.forEach(_=>i(_))}})}),M]},w=localStorage.getItem("login"),Q=localStorage.getItem("users-oauth"),d=JSON.parse(Q),X=localStorage.getItem("pocketbase_auth"),l=JSON.parse(X),m=a("#saveButton"),Y=h(".cancelButton");JSON.parse(w)&&z();const Z=[{id:"nameInput",min:0,max:8,placeholder:"별명이나 이름을 입력해주세요.",label:"이름"},{id:"jobInput",min:0,max:20,placeholder:"어떤 일을 하는지 알려주세요.",label:"직업"},{id:"companyInput",min:0,max:24,placeholder:"일하시는 곳을 알려주세요.",label:"직장"}],[,ee]=K(Z),x=a("#aboutMeInput"),P=a("#characterCount");function U(){const e=x.value.length;P.textContent=`${e}/500`,e>500&&(x.value=x.value.substring(0,500),P.textContent="500/500")}x.addEventListener("input",U);const O=a("#private"),R=a("#male"),T=a("#female");function E(e){const t=document.querySelector("[checked]");t&&t.removeAttribute("checked"),e.target.setAttribute("checked","checked")}O.addEventListener("click",E);R.addEventListener("click",E);T.addEventListener("click",E);const r={input:[...h(".required-input")].every(e=>e.value.length>0),agree:!1},$=a("#all-agree-checkbox"),S=h(".agree-checkbox"),te=()=>{const e=[...S].every(t=>t.checked);e?(r.agree=!0,m.disabled=!r.input||!r.agree):(m.disabled=!0,r.agree=!1),$.checked=e};$.addEventListener("change",()=>{const e=$.checked;S.forEach(t=>{t.checked=e}),m.disabled=!e,r.agree=e,m.disabled=!r.input||!r.agree});S.forEach(e=>{e.addEventListener("change",te)});const ae=h(".required input");ae.forEach(e=>{e.classList.add("required-input")});const q=Array.from(h(".required-input"));q.forEach(e=>{e.addEventListener("input",()=>{const t=q.every(c=>c.value!=="");r.input=t,m.disabled=!r.input||!r.agree})});const[V,ne]=W({title:"🥳 저장 완료!",desc:"프로필 정보가 저장되었습니다.",buttonText:"확인"}),[N,oe,ce]=G({title:"😱 나가시겠어요?",desc:"변경사항이 저장되지 않아요. <br /> 정말로 나가시겠어요?",cancelText:"취소",submitText:"확인"}),y=a("#nameInput"),L=a("#jobInput"),I=a("#companyInput"),C=a("#aboutMeInput"),v=a("#file"),k=a("#image-wrapper"),se=async()=>{const e=document.querySelector('input[name="gender"]:checked');if(w==="false"){const t=new Uint16Array(1),c=crypto.getRandomValues(t).join(""),g={username:`${d.email.split("@")[0]}`,email:`${d.email}`,emailVisibility:!0,password:`${d.password}`,passwordConfirm:`${d.passwordConfirm}`,categorys:d.categorys.map(i=>i.toLowerCase()),phone:`${d.phone}`,avatar:v.files[0],name:`${y.value}`,gender:`${e.id}`,job:`${L.value}`,company:`${I.value}`,introduce:`${C.value}`,period:Math.ceil(Math.random()*10),userCord:c,sellingProductCount:123};V.closing(),await b.collection("users").create(g),await b.collection("users").authWithPassword(d.email,d.password).then(()=>{window.location.href="/src/pages/main/"}),localStorage.removeItem("users-oauth"),localStorage.setItem("login","true")}else{const t={avatar:v.files[0],name:`${y.value}`,gender:`${e.id}`,job:`${L.value}`,company:`${I.value}`,introduce:`${C.value}`};t.avatar=v.files[0]||null,b.collection("users").update(l.model.id,t).then(()=>{window.location.href="/src/pages/myeuid/myProfile.html"})}};ne.onclick=se;m.onclick=()=>V.showing();const re=window.localStorage,ie=()=>{w==="true"?window.location.href="/src/pages/myeuid/myProfile.html":(re.clear(),window.location.href="/")},le=()=>N.closing();oe.onclick=le;ce.onclick=ie;Y.forEach(e=>{e.onclick=()=>N.showing()});const A=a("#image-preview"),de=a("#file-clear");function ue({target:e}){if(e.value==="")return;const{files:t}=e;k.innerHTML="",[...t].forEach(c=>{const g=URL.createObjectURL(c),i=document.createElement("img");i.classList.add("w-[50px]","h-[50px]"),i.id="userImg",i.src=g,k.appendChild(i)}),A.classList.remove("hidden")}v.addEventListener("change",ue);function pe({target:e}){v.value="",k.innerHTML="",A.classList.add("hidden")}de.addEventListener("click",pe);function me(e,t="photo"){return`https://suppose-weather.pockethost.io//api/files/users/${l.model.id}/${e[t]}`}if(w==="true"){const e=await b.collection("users").getOne(l.model.id,{fields:"avatar"});l.model.avatar!==""&&(A.classList.remove("hidden"),k.insertAdjacentHTML("afterbegin",`
    <img class="w-[50px] h-[50px]" id="userImg" src="${me(e,"avatar")}">
    `)),y.value=l.model.name,L.value=l.model.job,I.value=l.model.company,C.value=l.model.introduce,U(),ee.state=!0;const t=l.model.gender,c=a(`#${t}`);c?c.setAttribute("checked","checked"):(O.removeAttribute("checked"),R.removeAttribute("checked"),T.removeAttribute("checked"))}
